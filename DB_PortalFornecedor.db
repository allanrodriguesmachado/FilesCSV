/**
  @Allan Rodrigues
  --- Criação da base de dados ---
 */

CREATE TABLE representante
(
    id_representante SERIAL,
    doc1             VARCHAR(14) UNIQUE NOT NULL,
    nome_completo    varchar(200)       NOT NULL,
    email            VARCHAR(100)       NOT NULL,
    ts_inclusao      timestamp          NOT NULL DEFAULT now(),
    PRIMARY KEY (id_representante)
);

CREATE TABLE empresa
(
    id_empresa       SERIAL,
    id_contato       SERIAL,
    id_endereco      SERIAL,
    id_cancelamento  SERIAL,
    id_representante SERIAL,
    razao_social     VARCHAR(255) NOT NULL,
    nome_fantasia    VARCHAR(255) NOT NULL,
    CNPJ             VARCHAR(14)  NOT NULL,
    ts_inclusao      timestamp    NOT NULL default now(),
    PRIMARY KEY (id_empresa),
    CONSTRAINT id_contato FOREIGN KEY (id_contato)
);

CREATE TABLE endereco_compl
(
    id_endereco SERIAL,
    rua         VARCHAR(255) NOT NULL,
    numero      VARCHAR(255),
    bairro      VARCHAR(255) NOT NULL,
    complemento varchar(255),
    cidade      VARCHAR(255) NOT NULL,
    municipio   VARCHAR(255) NOT NULL,
    estado      VARCHAR(255) NOT NULL,
    ts_inclusao timestamp    NOT NULL DEFAULT now(),
    PRIMARY KEY (id_endereco)
);

CREATE TABLE contato
(
    id_contato   SERIAL,
    ddd_telefone NUMERIC(2),
    telefone     NUMERIC(8),
    ddd_celular  NUMERIC(2),
    celular      NUMERIC(9),
    ddd_fax      NUMERIC(2),
    fax          NUMERIC(8),
    ts_inclusao  timestamp NOT NULL DEFAULT now(),
    PRIMARY KEY (id_contato)
);

CREATE TABLE cancelamento
(
    id_cancelamento     SERIAL,
    motivo_cancelamento VARCHAR(255),
    ts_inclusao         timestamp NOT NULL DEFAULT now(),
    PRIMARY KEY (id_cancelamento)
);

CREATE TABLE validacao
(
    id_validacao     SERIAL,
    motivo_validacao VARCHAR(255),
    ts_inclusao      timestamp NOT NULL DEFAULT now(),
    PRIMARY KEY (id_validacao)
);

SELECT id_empresa,
       razao_social,
       cnpj,
       nome_fantasia,
       ddd_telefone,
       telefone,
       ddd_celular,
       celular
FROM empresa
         JOIN contato ON empresa.id_contato = contato.id_contato


/**
 * Alterações e correções
**/
ALTER TABLE empresa
    ADD CONSTRAINT fk_ende FOREIGN KEY (id_ende) REFERENCES endereco_compl (id_ende)
ALTER TABLE endereco_compl
    ADD COLUMN cep VARCHAR(5)


BEGIN;

INSERT INTO contato (ddd_telefone, telefone, ddd_celular, celular)
VALUES ('11', '47531663', '11', '958664570');

INSERT INTO endereco_compl (cep, rua, numero, bairro, complemento, cidade, municipio, estado)
VALUES ('08578', 'Rua Amazonas', '82', 'Rancho Grande', 'Sem Complemento', 'São Paulo', 'Itaquaquecetuba', 'SP');

INSERT INTO empresa(razao_social, nome_fantasia, cnpj, id_contato, id_ende)
VALUES ('Empresa1', 'RazaoSocial1', '1234872371273', currval('contato_id_contato_seq'),
        currval('endereco_compl_id_endereco_seq'));

COMMIT;

ROLLBACK;

SELECT *
FROM empresa
         JOIN contato ON empresa.id_contato = contato.id_contato
         JOIN endereco_compl ON empresa.id_ende = endereco_compl.id_ende



SELECT * FROM representante
